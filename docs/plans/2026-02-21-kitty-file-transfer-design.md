# Kitty 文件传输设计

## 背景

用户需要通过 lbpSSH 使用 Kitty 协议进行文件传输，替代之前的 SSH SFTP 方案。

## 目标

- 仅支持 Kitty 文件传输协议
- 上传/下载显示进度提示
- 远程不支持时显示安装提示

## 架构

### 数据流

```
用户点击上传
    ↓
建立终端连接（如未连接）
    ↓
检测 Kitty 协议支持
    ↓
┌─────────────────────────────────────┐
│  支持                               │
│    → 显示上传对话框                  │
│    → 发送文件（实时显示进度）       │
│    → 完成/失败提示                  │
│  不支持 → 显示安装提示              │
└─────────────────────────────────────┘
```

## 组件

### 1. KittyFileTransferService

- 协议支持检测（通过终端发送查询命令）
- 文件发送（带进度回调）
- 文件接收（带进度回调）
- 传输取消

### 2. TransferProgressDialog

- 文件名、大小显示
- 进度条（百分比）
- 传输速率
- 已传输/总大小
- 取消按钮

### 3. 错误提示

当远程不支持 Kitty 协议时：
```
远程服务器不支持 Kitty 文件传输协议。
请在远程服务器安装 Kitty 的 ki 工具：
  curl -L https://sw.kovidgoyal.net/kitty/ki/releases/latest/kitty-installer.sh | sh baseinstaller.sh

或联系服务器管理员。
```

## 进度提示 UI

```
┌─────────────────────────────────────┐
│  上传文件: test.zip                 │
│  ████████████░░░░░░░░░░░  45%      │
│  已传输: 4.5 MB / 10 MB           │
│                                     │
│           [取消]                    │
└─────────────────────────────────────┘
```

## 实现步骤

1. 增强 KittyFileTransferService - 添加进度回调支持
2. 增强 TerminalSession - 添加发送 OSC 序列方法
3. 创建 TransferProgressDialog - 进度提示对话框
4. 集成到文件浏览器 - 替换 SFTP 调用

## 验收标准

- [ ] 支持通过终端发送 OSC 5113 序列
- [ ] 上传显示进度条
- [ ] 显示传输速率
- [ ] 支持取消传输
- [ ] 远程不支持时显示安装提示
